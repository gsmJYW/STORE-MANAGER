<!DOCTYPE html>
<!-- Created by CodingLab |www.youtube.com/CodingLabYT-->
<html lang="en" dir="ltr">

<head>
    <meta charset="UTF-8">
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.0-beta1/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" />

    <title>STORE MANAGER</title>
    <link rel="icon" type="image/x-icon" href="https://imgur.com/YPhrrAJ.png">

    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.0-beta1/js/bootstrap.bundle.min.js"></script>
    <meta name="google-signin-client_id"
        content="36522862962-n5ba78aee74h5jggnppe3udfoupipu35.apps.googleusercontent.com">
    <meta name="google-signin-cookiepolicy" content="single_host_origin">
    <meta name="google-signin-scope" content="profile email">

    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.10.2/Sortable.min.js"></script>

    <style>
        @import url(//fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700&display=swap);

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Poppins", sans-serif;
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100%;
            width: 78px;
            background: #11101D;
            padding: 6px 14px;
            z-index: 99;
            transition: all 0.5s ease;
        }

        .sidebar.open {
            width: 250px;
        }

        .sidebar .logo-details {
            height: 60px;
            display: flex;
            align-items: center;
            position: relative;
        }

        .sidebar .logo-details .icon {
            opacity: 0;
            transition: all 0.5s ease;
        }

        .sidebar .logo-details .logo_name {
            color: #fff;
            font-size: 20px;
            font-weight: 600;
            opacity: 0;
            transition: all 0.5s ease;
        }

        .sidebar.open .logo-details .icon,
        .sidebar.open .logo-details .logo_name {
            opacity: 1;
        }

        .sidebar .logo-details #btn {
            position: absolute;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            font-size: 22px;
            transition: all 0.4s ease;
            font-size: 23px;
            text-align: center;
            cursor: pointer;
            transition: all 0.5s ease;
        }

        .sidebar.open .logo-details #btn {
            text-align: right;
        }

        .sidebar i {
            color: #fff;
            height: 60px;
            min-width: 50px;
            font-size: 28px;
            text-align: center;
            line-height: 60px;
        }

        .sidebar .nav-list {
            margin: 0px;
            padding: 0px;
            height: 100%;
        }

        .sidebar li {
            position: relative;
            margin: 8px 0;
            list-style: none;
        }

        .sidebar li .tooltip {
            position: absolute;
            top: -20px;
            left: calc(100% + 15px);
            z-index: 3;
            background: #fff;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 15px;
            font-weight: 400;
            opacity: 0;
            white-space: nowrap;
            pointer-events: none;
            transition: 0s;
        }

        .sidebar li:hover .tooltip {
            opacity: 1;
            pointer-events: auto;
            transition: all 0.4s ease;
            top: 50%;
            transform: translateY(-50%);
        }

        .sidebar.open li .tooltip {
            display: none;
        }

        .sidebar input {
            font-size: 15px;
            color: #FFF;
            font-weight: 400;
            outline: none;
            height: 50px;
            width: 100%;
            width: 50px;
            border: none;
            border-radius: 12px;
            transition: all 0.5s ease;
            background: #1d1b31;
        }

        .sidebar.open input {
            padding: 0 20px 0 50px;
            width: 100%;
        }

        .sidebar .bx-search {
            position: absolute;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            font-size: 22px;
            background: #1d1b31;
            color: #FFF;
        }

        .sidebar.open .bx-search:hover {
            background: #1d1b31;
            color: #FFF;
        }

        .sidebar .bx-search:hover {
            background: #FFF;
            color: #11101d;
        }

        .sidebar li a {
            display: flex;
            height: 100%;
            width: 100%;
            border-radius: 12px;
            align-items: center;
            text-decoration: none;
            transition: all 0.4s ease;
            background: #11101D;
        }

        .sidebar li a:hover {
            background: #FFF;
        }

        .sidebar li a .links_name {
            color: #fff;
            font-size: 15px;
            font-weight: 400;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: 0.4s;
        }

        .sidebar.open li a .links_name {
            opacity: 1;
            pointer-events: auto;
        }

        .sidebar li a:hover .links_name,
        .sidebar li a:hover i {
            transition: all 0.5s ease;
            color: #11101D;
        }

        .sidebar li i {
            height: 50px;
            line-height: 50px;
            font-size: 18px;
            border-radius: 12px;
        }

        .sidebar li.profile {
            position: fixed;
            height: 60px;
            width: 78px;
            left: 0;
            bottom: -8px;
            padding: 10px 14px;
            background: #1d1b31;
            transition: all 0.5s ease;
            overflow: hidden;
        }

        .sidebar.open li.profile {
            width: 250px;
        }

        .sidebar li .profile-details {
            display: flex;
            align-items: center;
            flex-wrap: nowrap;
        }

        .sidebar li img {
            height: 45px;
            width: 45px;
            object-fit: cover;
            border-radius: 6px;
            margin-right: 10px;
        }

        .sidebar li.profile .name,
        .sidebar li.profile .email {
            font-size: 15px;
            font-weight: 400;
            color: #fff;
            white-space: nowrap;
        }

        .sidebar li.profile .email {
            font-size: 7px;
        }

        .sidebar .profile #signout {
            position: absolute;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            background: #1d1b31;
            width: 100%;
            height: 60px;
            line-height: 60px;
            border-radius: 0px;
            transition: all 0.5s ease;
            cursor: pointer;
        }

        .sidebar.open .profile #signout {
            width: 50px;
            background: none;
        }

        .home-section {
            position: relative;
            background: #E4E9F7;
            min-height: 100vh;
            top: 0;
            left: 78px;
            width: calc(100% - 78px);
            transition: all 0.5s ease;
            z-index: 2;
        }

        .sidebar.open~.home-section {
            left: 250px;
            width: calc(100% - 250px);
        }

        .home-section .text {
            display: inline-block;
            color: #11101d;
            font-size: 25px;
            font-weight: 500;
            margin: 18px
        }

        .sidebar-icon {
            width: 10px;
            height: 10px;
        }

        @media (max-width: 420px) {
            .sidebar li .tooltip {
                display: none;
            }
        }
    </style>
</head>

<body>
    <div class="sidebar">
        <div class="logo-details">
            <div class="logo_name">&nbsp;&nbsp;STORE MANAGER</div>
            <i class='bx bx-menu' id="btn"></i>
        </div>
        <ul class="nav-list">
            <li class="signin-needed" hidden>
                <a id="smartstore-button" href="#">
                    <img src="https://imgur.com/xpWa0pd.png" style="width: 25px; height: 25px; margin: 12px"></i>
                    <span class="links_name">스마트스토어</span>
                </a>
                <span class="tooltip">스마트스토어</span>
            </li>
            <li class="permission-needed" hidden>
                <a href="/n09">
                    <img src="https://imgur.com/YPhrrAJ.png" style="width: 30px; height: 30px; margin: 9px"></i>
                    <span class="links_name">엔공구</span>
                </a>
                <span class="tooltip">엔공구</span>
            </li>
            <li class="permission-needed" hidden>
                <a href="/n09/b2b">
                    <img src="https://imgur.com/ridw5Rm.png" style="width: 30px; height: 30px; margin: 9px"></i>
                    <span class="links_name">엔공구 B2B</span>
                </a>
                <span class="tooltip">엔공구 B2B</span>
            </li>
            <li class="permission-needed" hidden>
                <a href="/autowash">
                    <img src="https://imgur.com/pZDIKRo.jpg" style="width: 25px; height: 25px; margin: 12px"></i>
                    <span class="links_name">오토워시</span>
                </a>
                <span class="tooltip">오토워시</span>
            </li>
            <!-- <li class="permission-needed" hidden>
                <a href="/autowash/b2b">
                    <img src="https://imgur.com/iUCokFJ.png" style="width: 25px; height: 25px; margin: 12px"></i>
                    <span class="links_name">오토워시 B2B</span>
                </a>
                <span class="tooltip">오토워시 B2B</span>
            </li> -->
            <li class="permission-needed" hidden>
                <a href="/hyundai/auton">
                    <img src="https://imgur.com/6sSNXyV.jpg" style="width: 25px; height: 25px; margin: 12px"></i>
                    <span class="links_name">카라이프몰</span>
                </a>
                <span class="tooltip">카라이프몰</span>
            </li>
            <li class="permission-needed" hidden>
                <a href="/theclass">
                    <img src="https://imgur.com/jPj4u7P.png" style="width: 25px; height: 25px; margin: 12px"></i>
                    <span class="links_name">더클래스</span>
                </a>
                <span class="tooltip">더클래스</span>
            </li>
            <li class="permission-needed" hidden>
                <a href="/autowax">
                    <img src="https://imgur.com/DMyMPHa.jpg" style="width: 25px; height: 25px; margin: 12px"></i>
                    <span class="links_name">오토왁스</span>
                </a>
                <span class="tooltip">오토왁스</span>
            </li>
            <li class="permission-needed" hidden>
                <a href="/washmart">
                    <img src="https://imgur.com/NUznjlg.png" style="width: 25px; height: 25px; margin: 12px"></i>
                    <span class="links_name">워시마트</span>
                </a>
                <span class="tooltip">워시마트</span>
            </li>
            <li class="permission-needed" hidden>
                <a href="/cjtracking">
                    <img src="https://imgur.com/7rDETQx.png" style="width: 25px; height: 25px; margin: 12px"></i>
                    <span class="links_name">CJ 배송 조회</span>
                </a>
                <span class="tooltip">CJ 배송 조회</span>
            </li>
            <li class="signin-needed" hidden>
                <a id="car-wash-button" href="/carwash">
                    <i class='bx bxs-car-wash'></i>
                    <span class="links_name">전국 세차장</span>
                </a>
                <span class="tooltip">전국 세차장</span>
            </li>
            <li class="signin-needed" hidden>
                <a id="option-button" href="#">
                    <i class='bx bx-cog'></i>
                    <span class="links_name">설정</span>
                </a>
                <span class="tooltip">설정</span>
            </li>
            <li class="signin-needed" hidden>
                <a id="quota-button" href="#">
                    <i class='bx bx-pie-chart'></i>
                    <span class="links_name">사용량</span>
                </a>
                <span class="tooltip">사용량</span>
            </li>
            <li class="permission-needed" hidden>
                <a id="admin-button" href="/admin">
                    <i class='bx bx-user'></i>
                    <span class="links_name">관리자</span>
                </a>
                <span class="tooltip">관리자</span>
            </li>
            <li class="signin-not-needed" hidden>
                <a id="info-button" href="#">
                    <i class='bx bx-help-circle'></i>
                    <span class="links_name">처음이세요?</span>
                </a>
                <span class="tooltip">처음이세요?</span>
            </li>
            <li class="profile">
                <div class="profile-details">
                    <div class="email-name">
                        <div id="name" class="name">계정 없음</div>
                        <div id="email" class="email">기능을 열기 위해 로그인 해주세요</div>
                    </div>
                </div>
                <i class='bx bx-log-out' id="signout"></i>
            </li>
        </ul>
    </div>
    <section class="home-section">
        <div class="d-flex" style="float: right; margin: 15px">
            <div id="signin-button" class="g-signin2" data-onsuccess="onSignIn"></div>
            <div class="container d-flex align-items-center justify-content-center"
                style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%)">
                <div>
                    <div class="text-center">
                        <a href="http://n09company.com" target="_blank"><img src="https://imgur.com/YPhrrAJ.png"
                                width="160" height="160" style="margin: 0px 0px"></a>
                    </div>
                    <p
                        style="text-align: center; line-height: 150%; font-size: 14px; font-weight: 100; margin: 66px 0px 77px 0px">
                        해당
                        서비스는 ㈜엔공구의 자회사 공구형에서
                        개발합니다.<br>현재 베타 서비스
                        단계이며 무료로 이용하실 수
                        있습니다.<br>후원금은 서비스
                        운영을 위한 서버 유지 비용에 사용됩니다.
                    </p>
                    <p
                        style="text-align: center; line-height: 150%; font-size: 14px; font-weight: 100; margin: 77px 0px">
                        <b>공구형 고객센터</b> 010-3924-8171<br><b>후원 계좌</b> 광주은행 1121-022-248925 (최만수)<br><br>
                        <b>상호명</b> 공구형 &nbsp; <b>사업자 번호</b> 226-28-19779 <br> <b>주소</b> 광주광역시 광산구
                        하남산단 6번로 57 (지식동 908호)
                    </p>
                    <div class="text-center">
                        <a href="https://09bro.net" target="_blank"><img src="https://imgur.com/7HP4qOb.png" width="72"
                                height="24" style="margin: 0px 8px;"></a>
                        <a href="https://play.google.com/store/apps/details?id=com.n09.fanorama" target="_blank"><img
                                src="https://imgur.com/Ranntdk.png" width="36" height="36" style="margin: auto"></a>
                    </div>
                    <div hidden>
                        <!-- Start: Copyright 2022 TraceMyIP.org Service Code (004635-03042022)- DO NOT MODIFY //-->
                        <div id="elemID031021"
                            style="line-height:16px;text-align:center;position:relative;z-index:100000;">
                            <script type="text/javascript"
                                src="//s3.tracemyip.org/tracker/lgUrl.php?random='+Math.random()+'&amp;stlVar2=1401&amp;rgtype=4684NR-IPIB&amp;pidnVar2=60431&amp;prtVar2=5&amp;scvVar2=12"></script>
                            <noscript><a
                                    href="https://www.tracemyip.org/tools/website-visitors-counter-traffic-tracker-statistics/"><img
                                        src="//s3.tracemyip.org/tracker/1401/4684NR-IPIB/60431/5/12/ans/"
                                        alt="Web Site Hits Ipv4 Tracer" style="border:0px;"></a></noscript>
                        </div> <!-- End: TraceMyIP.org Service Code //-->
                    </div>
                </div>
            </div>
            <script type="module">
                // Auth

                showLoading('유저 정보를 불러오는 중이에요.')

                import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.6/firebase-app.js'
                import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithCredential, signOut } from "https://www.gstatic.com/firebasejs/9.6.6/firebase-auth.js"

                initializeApp({
                    apiKey: "AIzaSyDevqbIK-lcqYdqbmfBAWGPrSHlJT7F0FQ",
                    authDomain: "store-manager-5d527.firebaseapp.com",
                    projectId: "store-manager-5d527",
                    storageBucket: "store-manager-5d527.appspot.com",
                    messagingSenderId: "36522862962",
                    appId: "1:36522862962:web:8a9e9b88373a19add095eb",
                    measurementId: "G-37DECVWLYX"
                })

                const auth = getAuth()

                const signinNeededList = document.getElementsByClassName('signin-needed')
                const signinNotNeededList = document.getElementsByClassName('signin-not-needed')
                const permissionNeededList = document.getElementsByClassName('permission-needed')

                let user

                onAuthStateChanged(auth, async (firebaseUser) => {
                    for (let signinNotNeeded of signinNotNeededList) {
                        signinNotNeeded.hidden = false
                    }

                    if (firebaseUser) {
                        user = firebaseUser

                        document.getElementById('name').innerText = user.displayName
                        document.getElementById('email').innerText = user.email

                        for (let signinNeeded of signinNeededList) {
                            signinNeeded.hidden = false
                        }

                        try {
                            let json = await postAsync('/signin', { idToken: await user.getIdToken() })

                            if (json.result == 'error') {
                                throw new Error(json.error)
                            }

                            if (json.user.permission == 1) {
                                for (let permissionNeeded of permissionNeededList) {
                                    permissionNeeded.hidden = false
                                }
                            }

                            swal.close()
                        }
                        catch (error) {
                            showErrorWithRefresh(`
                                <div style="line-height: 130%">
                                    로그인 도중 오류가 발생했어요.<br>
                                    다시 시도해주세요.
                                </div>
                            `, error.message)
                        }
                    }
                    else {
                        let res = await swalAsync({
                            title: '환영합니다!',
                            html: '기능을 열기 위해 회원가입 또는 로그인 해주세요!',
                            icon: 'success',
                            showCancelButton: true,
                            confirmButtonText: '어떻게요?',
                            cancelButtonText: '알겠어요',
                        })

                        if (res.isConfirmed) {
                            await swalAsync({
                                title: '회원가입 및 로그인',
                                html: '우측 상단의 <img src="https://imgur.com/7l7Kakh.png"></img> 버튼을 통해 할 수 있습니다.<br>Google을 통해 로그인 하시면 회원가입 및 로그인이 끝나요!',
                                icon: 'info',
                                confirmButtonText: '멋지네요!',
                            })
                        }
                    }
                })

                function onSignIn(googleUser) {
                    const unsubscribe = onAuthStateChanged(auth, (firebaseUser) => {
                        unsubscribe()
                        if (!isUserEqual(googleUser, firebaseUser)) {
                            const credential = GoogleAuthProvider.credential(googleUser.getAuthResponse().id_token)

                            signInWithCredential(auth, credential).then(() => location.reload()).catch((error) => {
                                showError(`
                                    <div style="line-height: 130%">
                                        로그인 도중 오류가 발생했어요.<br>
                                        다시 시도해주세요.
                                    </div>
                                `, error.message)
                            })
                        }
                    })
                }

                document.getElementById('signout').addEventListener('click', () => {
                    signOut(auth).then(() => location.reload()).catch((error) => {
                        showError(`
                            <div style="line-height: 130%">
                                로그아웃 도중 오류가 발생했어요.<br>
                                다시 시도해주세요.
                            </div>
                        `, error.message)
                    });
                })

                function isUserEqual(googleUser, firebaseUser) {
                    if (firebaseUser) {
                        const providerData = firebaseUser.providerData
                        for (let i = 0; i < providerData.length; i++) {
                            if (providerData[i].providerId === GoogleAuthProvider.PROVIDER_ID &&
                                providerData[i].uid === googleUser.getBasicProfile().getId()) {
                                return true
                            }
                        }
                    }
                    return false
                }

                window.onSignIn = onSignIn



                // 스마트스토어

                const searchHelper = document.getElementById('search-helper')

                document.getElementById('smartstore-button').addEventListener('click', () => smartstoreSearchPopup())

                async function smartstoreSearchPopup() {
                    let div = document.createElement('div')

                    let searchInput = document.createElement('input')
                    searchInput.setAttribute('type', 'search')
                    searchInput.classList.add('form-control', 'rounded', 'p-2')
                    searchInput.style = 'box-shadow: none;'
                    searchInput.setAttribute('placeholder', '스토어 이름 또는 URL')
                    searchInput.setAttribute('spellcheck', 'false')

                    let searchButton = document.createElement('button')
                    searchButton.classList.add('btn', 'btn-primary', 'fas', 'fa-search')

                    searchInput.addEventListener('keyup', (e) => {
                        if (e.code == 'Enter') {
                            smartstoreSearch(searchInput.value)
                        }
                    })
                    searchButton.addEventListener('click', () => smartstoreSearch(searchInput.value))

                    let inputDiv = div.cloneNode(true)
                    inputDiv.classList.add('input-group', 'rounded', 'p-2')
                    inputDiv.appendChild(searchInput)
                    inputDiv.appendChild(searchButton)

                    let searchHelper = document.createElement('h6')
                    searchHelper.classList.add('text-center', 'px-2')
                    searchHelper.style = 'line-height: 130%; font-weight: 100'

                    let form = document.createElement('form')
                    form.appendChild(searchHelper)

                    div.appendChild(inputDiv)
                    div.appendChild(form)

                    swal.fire({
                        title: '스마트스토어',
                        html: div,
                        showConfirmButton: false,
                        showCancelButton: true,
                        cancelButtonText: '취소'
                    })

                    try {
                        let json = await postAsync('/bookmark', { idToken: await user.getIdToken() })

                        if (json.result == 'error') {
                            throw new Error(json.error)
                        }

                        let bookmarkList = json.bookmark
                        bookmarkList.sort((a, b) => a.title - b.title)

                        if (bookmarkList.length > 0) {
                            searchHelper.innerHTML = ''
                        }

                        let isThereBoomark = false
                        let recentHeight = Infinity

                        for (let bookmark of bookmarkList) {
                            if (isThereBoomark) {
                                let span = document.createElement('span')
                                span.innerHTML = '&nbsp&nbsp'
                                searchHelper.appendChild(span)
                            }

                            isThereBoomark = true

                            let a = document.createElement('a')
                            a.innerHTML = bookmark.title

                            if (bookmark.storeUrl.includes('smartstore.naver.com')) {
                                let endpoint = bookmark.storeUrl.split('/').pop()
                                a.setAttribute('href', `/smartstore/${endpoint}`)
                            }

                            searchHelper.appendChild(a)

                            if (searchHelper.offsetHeight > recentHeight) {
                                let br = document.createElement('br')
                                searchHelper.insertBefore(br, a)
                            }

                            recentHeight = searchHelper.offsetHeight
                        }

                        if (!isThereBoomark) {
                            searchHelper.innerHTML = '매번 검색하기 힘드시죠? 클릭만으로 접속하세요! '

                            let howToBookmark = document.createElement('button')
                            howToBookmark.type = "button"
                            howToBookmark.style = 'background: none; border: none; margin: 0; padding: 0; color: #0066CC'
                            howToBookmark.innerHTML = '즐겨찾기 사용법'
                            howToBookmark.setAttribute('onclick', `
                                swal.fire({
                                    title: '즐겨찾기 A to Z',
                                    html: \`
                                    <div style="text-align: left; line-height: 130%">
                                    <div class="text-center">
                                        <img src="https://imgur.com/zbj1mBU.png" width="454" height="47">
                                    </div>
                                    <div class="text-center" style="margin: 8px 0px">
                                        <img src="https://imgur.com/x13joXj.png" width="454" height="81">
                                    </div><br>
                                        1. 최초 한 번은 검색창을 통해 스토어에 접속해주세요.<br>
                                        2. 스토어 이름 옆 노란 별 아이콘을 클릭해주세요.<br>
                                        3. 메인 페이지로 돌아가면 바로가기 링크가 생겨요!<br><br>
                                    <div class="text-center"><img src="https://imgur.com/YtMW1un.png" width="454" height="67"></div><br>
                                        즐겨찾기는 계정 당 10개까지만 등록하실 수 있어요.<br>
                                    </div>
                                    \`,
                                    confirmButtonText: '알겠어요',
                                }).then(() => smartstoreSearchPopup())
                            `)

                            searchHelper.appendChild(howToBookmark)
                        }
                    }
                    catch (error) {
                        showError(`
                            <div style="line-height: 130%">
                                즐겨찾기를 불러오는 도중 오류가 발생했어요.<br>
                                다시 시도해주세요.
                            </div>
                        `, error.message)
                    }
                }

                window.smartstoreSearchPopup = smartstoreSearchPopup

                async function smartstoreSearch(query) {
                    if (query.trim().length == 0) {
                        return
                    }

                    swal.fire({
                        title: '잠시만요!',
                        text: '스토어에 접속하는 중이에요.',
                        showCancelButton: false,
                        showConfirmButton: false,
                        allowOutsideClick: false,
                        heightAuto: false,
                    })

                    try {
                        let json = await postAsync('/smartstore/search', { query: query })

                        if (json.result == 'error') {
                            throw new Error(json.error)
                        }

                        if (json.result == 'ok') {
                            swal.fire({
                                title: '스토어 발견!',
                                html: `'${json.storeTitle}' 스토어로 진행 하시겠어요?`,
                                icon: 'success',
                                confirmButtonText: '네',
                                cancelButtonText: '이게 아닌데!',
                                showCancelButton: true,
                                heightAuto: false,
                            }).then((res) => {
                                if (res.isConfirmed) {
                                    let form = document.createElement('form')
                                    form.style.visibility = 'hidden'
                                    form.method = 'GET'
                                    form.action = `/smartstore/${json.storeUrl}`
                                    document.body.appendChild(form)
                                    form.submit()
                                }
                                else {
                                    smartstoreSearchPopup()
                                }
                            })
                        }
                        else if (json.result == 'zero results') {
                            swal.fire({
                                title: '잠시만요!',
                                html: `
                                    <div style="line-height: 130%">
                                        스토어를 검색했지만 찾지 못했어요.<br>
                                        검색어를 다시 한 번 확인해주세요.
                                    </div>
                                `,
                                confirmButtonText: '알겠어요',
                                heightAuto: false,
                            }).then(() => smartstoreSearchPopup())
                        }
                        else if (json.result == 'not smartstore url') {
                            swal.fire({
                                title: '잠시만요!',
                                html: `
                                    <div style="line-height: 130%">
                                        주소를 입력받았지만<br>
                                        스마트스토어 주소가 아니에요.<br>
                                    </div>
                                `,
                                confirmButtonText: '알겠어요',
                                heightAuto: false,
                            }).then(() => smartstoreSearchPopup())
                        }
                    }
                    catch (error) {
                        swal.fire({
                            title: '이런!',
                            html: '스토어를 검색하는 도중 오류가 발생했어요.',
                            icon: 'error',
                            confirmButtonText: '어떻게 된거죠?',
                            cancelButtonText: '알겠어요',
                            showCancelButton: true,
                            heightAuto: false,
                        }).then((res) => {
                            if (res.isConfirmed) {
                                swal.fire({
                                    title: '원인',
                                    html: error,
                                    confirmButtonText: '알겠어요',
                                    showCancelButton: false,
                                    heightAuto: false,
                                }).then(() => smartstoreSearchPopup())
                            }
                            else {
                                smartstoreSearchPopup()
                            }
                        })
                    }
                }



                // 설정

                document.getElementById('option-button').addEventListener('click', async () => {
                    try {
                        let json = await postAsync('/user', { idToken: await user.getIdToken() })

                        if (json.result == 'error') {
                            throw new Error(json.error)
                        }

                        let loadAll = document.createElement('input')
                        loadAll.classList.add('form-check-input')
                        loadAll.setAttribute('type', 'checkbox')

                        let highlightChanges = document.createElement('input')
                        highlightChanges.classList.add('form-check-input')
                        highlightChanges.setAttribute('type', 'checkbox')

                        let byRecent = document.createElement('input')
                        byRecent.classList.add('form-check-input')
                        byRecent.setAttribute('type', 'radio')
                        byRecent.setAttribute('name', 'sort-radio')

                        let byPopularity = document.createElement('input')
                        byPopularity.classList.add('form-check-input')
                        byPopularity.setAttribute('type', 'radio')
                        byPopularity.setAttribute('name', 'sort-radio')

                        let loadAllLabel = document.createElement('label')
                        loadAllLabel.innerText = '전부 로딩하기'

                        let highlightChangesLabel = document.createElement('label')
                        highlightChangesLabel.innerText = '바뀐 제품을 위로'

                        let byRecentLabel = document.createElement('label')
                        byRecentLabel.innerText = '최신 순으로'

                        let byPopularityLabel = document.createElement('label')
                        byPopularityLabel.innerText = '인기 순으로'

                        if (json.user.loadAll) {
                            loadAll.checked = true
                        }

                        if (json.user.highlightChanges) {
                            highlightChanges.checked = true
                        }

                        if (json.user.sortMethod == 0) {
                            byRecent.checked = true
                        }
                        else if (json.user.sortMethod == 1) {
                            byPopularity.checked = true
                        }

                        let loadAllDiv = document.createElement('div')
                        loadAllDiv.classList.add('form-check', 'form-check-inline')
                        loadAllDiv.appendChild(loadAll)
                        loadAllDiv.appendChild(loadAllLabel)

                        let highlightChangesDiv = document.createElement('div')
                        highlightChangesDiv.classList.add('form-check', 'form-check-inline')
                        highlightChangesDiv.appendChild(highlightChanges)
                        highlightChangesDiv.appendChild(highlightChangesLabel)

                        let byRecentDiv = document.createElement('div')
                        byRecentDiv.classList.add('form-check', 'form-check-inline')
                        byRecentDiv.appendChild(byRecent)
                        byRecentDiv.appendChild(byRecentLabel)

                        let byPopularityDiv = document.createElement('div')
                        byPopularityDiv.classList.add('form-check', 'form-check-inline')
                        byPopularityDiv.appendChild(byPopularity)
                        byPopularityDiv.appendChild(byPopularityLabel)

                        let span = document.createElement('span')
                        span.style = 'line-height: 130%'
                        span.innerHTML = `
                            스토어 접속 시 기본 설정이에요.<br>
                            그때그때 바꾸실 수 있어요.<br><br>
                        `

                        let space = document.createElement('span')
                        space.innerHTML = '&nbsp<br>'

                        let form = document.createElement('form')
                        form.appendChild(span)
                        form.appendChild(loadAllDiv)
                        form.appendChild(highlightChangesDiv)
                        form.appendChild(space)
                        form.appendChild(byRecentDiv)
                        form.appendChild(byPopularityDiv)

                        swal.fire({
                            title: '설정',
                            html: form,
                            confirmButtonText: '확인',
                            cancelButtonText: '안 돼요!',
                            showCancelButton: true,
                            heightAuto: false,
                        }).then(async (res) => {
                            if (res.isConfirmed) {
                                try {
                                    let json = await postAsync('/user/update', {
                                        idToken: await user.getIdToken(),
                                        loadAll: loadAll.checked ? 1 : 0,
                                        highlightChanges: highlightChanges.checked ? 1 : 0,
                                        sortMethod: byRecent.checked ? 0 : 1,
                                    })

                                    swal.fire({
                                        title: '설정 변경 성공!',
                                        icon: 'success',
                                        heightAuto: false,
                                        confirmButtonText: '좋네요!',
                                    })
                                }
                                catch (error) {
                                    showError(`
                                        <div style="line-height: 130%">
                                            설정을 변경하는 도중 오류가 발생했어요.<br>
                                            다시 시도해주세요.
                                        </div>
                                    `, error.message)
                                }
                            }
                        })
                    }
                    catch (error) {
                        showError(`
                            <div style="line-height: 130%">
                                설정을 불러오는 도중 오류가 발생했어요.<br>
                                다시 시도해주세요.
                            </div>
                        `, error.message)
                    }
                })



                // 사용량

                document.getElementById('quota-button').addEventListener('click', async () => {
                    try {
                        let json = await postAsync('/quota', { idToken: await user.getIdToken() })

                        if (json.result == 'error') {
                            throw new Error(json.error)
                        }

                        let productListQuota = 0
                        let updateQuota = 0
                        let saveQuota = 0

                        let productListQueryList = json.quota.filter((query) => query.type == 1)

                        for (let productListQuery of productListQueryList) {
                            productListQuota += productListQuery.amount
                        }

                        let updateQueryList = json.quota.filter((query) => query.type == 2)

                        for (let updateQuery of updateQueryList) {
                            updateQuota += updateQuery.amount
                        }

                        let saveQueryList = json.quota.filter((query) => query.type == 3)

                        for (let saveQuery of saveQueryList) {
                            saveQuota += saveQuery.amount
                        }

                        swal.fire({
                            title: '사용량',
                            html: `
                                    <span style="line-height: 130%">
                                        오늘의 사용량이에요.<br>
                                        사용량은 자정에 초기화 돼요!<br><br>
                                        조회 <b>${productListQuota.toLocaleString('ko-KR')} / 100,000개</b><br>
                                        업데이트 <b>${updateQuota.toLocaleString('ko-KR')} / 25,000개</b><br>
                                        엑셀로 저장 <b>${saveQuota.toLocaleString('ko-KR')} / 10회</b>
                                        ${json.isAdmin ? '<br><br>(관리자이셔서 영향을 받지 않아요)' : ''}
                                    </span>
                                `,
                            confirmButtonText: '알겠어요',
                            showCancelButton: false,
                        })
                    }
                    catch (error) {
                        showError(`
                            <div style="line-height: 130%">
                                사용량을 불러오는 도중 오류가 발생했어요.<br>
                                다시 시도해주세요.
                            </div>
                        `, error.message)
                    }
                })



                // 도움말

                document.getElementById('info-button').addEventListener('click', () => {
                    swal.fire({
                        title: '어서오세요!',
                        html: `
                            <div style="line-height: 130%"><br>
                                <b>STORE MANAGER</b>입니다.<br>
                                온라인 스토어의 판매 기록을 수집하실 수 있게 도와드려요!<br>
                                클릭 몇 번으로 수천수만 제품의 변화를 기록해 보세요!
                            </div>
                        `,
                        confirmButtonText: '어떻게요?',
                    }).then(() => {
                        swal.fire({
                            title: '어떻게요?',
                            html: `
                                <div style="line-height: 130%"><br>
                                    검색창에 스토어의 이름을 치세요, 완벽하게 안 쓰셔도 돼요!<br>
                                    <div class="text-center">
                                        <img src="https://imgur.com/zbj1mBU.png" width="454" height="47">
                                    </div><br>
                                    이름으로 검색이 안 되시나요? 주소로 검색하셔도 괜찮아요!<br>
                                    <div class="text-center">
                                        <img src="https://imgur.com/n6njz6V.png" width="454" height="47">
                                    </div><br>
                                    현재 지원하는 스토어: <b>NAVER 스마트스토어</b>
                                </div>
                            `,
                            confirmButtonText: '그래서요?',
                        }).then(() => {
                            swal.fire({
                                title: '그래서요?',
                                html: `
                                    <div style="line-height: 160%">
                                        성공적으로 스토어에 접속한 결과예요.
                                        <div class="text-center">
                                            <img src="https://imgur.com/x13joXj.png" width="454" height="81">
                                        </div><br>
                                        <button type="button" class="btn btn-primary" style="font-size: 14px; padding: 4px 8px; margin: 3px 0px 0px 0px">
                                            업데이트
                                        </button>
                                        버튼을 누르면 제품 정보를 수집해요.<br>
                                        수집된 제품 정보는 다음과 같이 일자로 구분하여 저장돼요.<br><br>
                                        <div class="text-center">
                                            <img src="https://imgur.com/yC6YGm5.png" width="454" height="110">
                                        </div><br>
                                        단순 확인을 원하시면 아무쪽에서나 선택하세요.<br>
                                        두 데이터를 비교하고 싶으시면 왼쪽은 과거 시점,<br>
                                        오른쪽은 왼쪽보다 최근 시점을 선택해주세요.<br>
                                    </div>
                                `,
                                confirmButtonText: '결과는요?',
                            }).then(() => {
                                swal.fire({
                                    title: '결과는요?',
                                    html: `
                                        <div style="line-height: 160%">
                                            데이터를 선택하시면 다음과 같이 표시돼요.<br>
                                            정렬 기준을 선택하시거나 다운로드 받으실 수도 있어요!<br><br>
                                            <div class="text-center" style="margin: 8px 0px">
                                                <img src="https://imgur.com/q1ZDJpG.png" width="454" height="322">
                                            </div><br>
                                            데이터 관리에 대해서는 걱정하지 마세요,<br>
                                            전부 저희 서버에 저장되니까요!<br>
                                        </div>
                                    `,
                                    confirmButtonText: '멋지네요!',
                                })
                            })
                        })
                    })
                })



                // 자주 사용하는 함수

                function showErrorWithRefresh(html, errorMessage) {
                    swal.fire({
                        title: '이런!',
                        html: html,
                        icon: 'error',
                        confirmButtonText: '어떻게 된거죠?',
                        cancelButtonText: '새로고침',
                        showCancelButton: true,
                        allowOutsideClick: false,
                        heightAuto: false,
                    }).then((res) => {
                        if (res.isConfirmed) {
                            swal.fire({
                                title: '원인',
                                html: errorMessage,
                                confirmButtonText: '새로고침',
                                showCancelButton: false,
                                allowOutsideClick: false,
                                heightAuto: false,
                            }).then(() => location.reload())
                        }
                    })
                }

                function showError(html, errorMessage) {
                    swal.fire({
                        title: '이런!',
                        html: html,
                        icon: 'error',
                        confirmButtonText: '어떻게 된거죠?',
                        cancelButtonText: '알겠어요',
                        showCancelButton: true,
                        heightAuto: false,
                    }).then((res) => {
                        if (res.isConfirmed) {
                            swal.fire({
                                title: '원인',
                                html: errorMessage,
                                confirmButtonText: '알겠어요',
                                showCancelButton: false,
                                heightAuto: false,
                            })
                        }
                    })
                }

                function showWarning(html) {
                    swal.fire({
                        title: '잠시만요!',
                        html: html,
                        confirmButtonText: '알겠어요',
                        heightAuto: false,
                    })
                }

                function showLoading(html) {
                    swal.fire({
                        title: '잠시만요!',
                        html: html,
                        showConfirmButton: false,
                        allowOutsideClick: false,
                        heightAuto: false,
                    })
                    swal.showLoading()
                }

                function postAsync(url, params = {}) {
                    return new Promise((resolve, reject) => {
                        fetch(url, {
                            method: 'POST',
                            headers: {
                                'Accept': 'application/json',
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(params),
                        }).then(async (res) => {
                            resolve(await res.json())
                        }).catch((error) => reject(error))
                    })
                }

                function swalAsync(params) {
                    return new Promise((resolve, reject) => {
                        swal.fire(params).then((res) => resolve(res))
                    })
                }
            </script>
    </section>
    <script>
        const sidebar = document.querySelector(".sidebar");
        const closeBtn = document.querySelector("#btn");

        closeBtn.addEventListener("click", () => {
            sidebar.classList.toggle("open");
            menuBtnChange();
        });

        function menuBtnChange() {
            if (sidebar.classList.contains("open")) {
                closeBtn.classList.replace("bx-menu", "bx-menu-alt-right");
            } else {
                closeBtn.classList.replace("bx-menu-alt-right", "bx-menu");
            }
        }
    </script>
</body>

</html>